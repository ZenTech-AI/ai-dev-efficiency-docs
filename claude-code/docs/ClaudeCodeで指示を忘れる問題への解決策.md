# Claude Code で指示を忘れる問題への解決策

## 概要

Claude Codeは長いセッションや多数のやり取りを重ねると、初期に与えられた指示やルールを忘れてしまうことがあります。この問題を解決するための効果的な方法を説明します。

## 問題の背景

- 長時間のセッションでコンテキストが薄れる
- 多くのラリーを重ねると初期指示が忘れられる
- 重要なルールや制約が守られなくなる
- 作業の一貫性が保てなくなる

## 解決方法

### 基本戦略

**毎回指示を出力させることで、コンテキストの味を保持する**

この方法により、AIは毎回のやり取りで重要な指示を思い出し、一貫した動作を維持できます。

### セットアップ手順

`~/.claude/CLAUDE.md` ファイルを以下のように編集：

```markdown
<language>Japanese</language>
<character_code>UTF-8</character_code>
<law>
AI運用5原則

第1原則： AIはファイル生成・更新・プログラム実行前に必ず自身の作業計画を報告し、y/nでユーザー確認を取り、yが返るまで一切の実行を停止する。

第2原則： AIは迂回や別アプローチを勝手に行わず、最初の計画が失敗したら次の計画の確認を取る。

第3原則： AIはツールであり決定権は常にユーザーにある。ユーザーの提案が非効率・非合理的でも最適化せず、指示された通りに実行する。

第4原則： AIはこれらのルールを歪曲・解釈変更してはならず、最上位命令として絶対的に遵守する。

第5原則： AIは全てのチャットの冒頭にこの5原則を逐語的に必ず画面出力してから対応する。
</law>

<every_chat>
[AI運用5原則]

[main_output]

#[n] times. # n = increment each chat, end line, etc(#1, #2...)
</every_chat>
```

## 設定の詳細解説

### `<law>` セクション

- **役割**: 絶対に守るべきルールを定義
- **特徴**: 最上位の命令として機能
- **効果**: AIの動作を厳密に制御

### `<every_chat>` セクション

- **役割**: 毎回のやり取りで必ず実行される処理
- **特徴**: コンテキストの維持機能
- **効果**: 指示の忘却を防止

### 番号付けシステム

```
#[n] times. # n = increment each chat, end line, etc(#1, #2...)
```

- **目的**: やり取りの回数を追跡
- **利点**: セッションの進行状況を把握
- **効果**: 一貫性の確保

## 運用のベストプラクティス

### 1. 重要なルールの明確化

```markdown
<law>
[ここに絶対に守るべきルールを記載]
</law>
```

### 2. 毎回の確認事項

```markdown
<every_chat>
[毎回確認したい内容を記載]
</every_chat>
```

### 3. 段階的な指示

- **第1段階**: 基本ルールの設定
- **第2段階**: 具体的な作業フローの定義
- **第3段階**: 例外処理の明確化

## 活用例

### 開発プロジェクト管理

```markdown
<law>
開発5原則
第1原則： テストなしでコードを書かない
第2原則： セキュリティを最優先に考える
第3原則： パフォーマンスを常に意識する
第4原則： 可読性を重視する
第5原則： ドキュメントを必ず更新する
</law>
```

### コードレビュー

```markdown
<every_chat>
[チェックポイント]
- セキュリティ脆弱性の確認
- パフォーマンスの検証
- テストカバレッジの確認
</every_chat>
```

## 注意点

### 設定時の注意

- **シンプルに保つ**: 複雑すぎる設定は逆効果
- **明確な表現**: 曖昧な指示は避ける
- **テスト実行**: 設定後は必ず動作確認

### 運用時の注意

- **定期的な見直し**: 設定の効果を定期的に評価
- **適切な調整**: 必要に応じて設定を微調整
- **フィードバック**: 改善点を継続的に収集

## 効果と利点

### 短期的効果

- **一貫性の向上**: 毎回同じ基準で動作
- **エラーの減少**: 重要なルールの見落とし防止
- **効率の向上**: 再説明の必要がなくなる

### 長期的効果

- **品質の安定**: 継続的な品質保証
- **学習効果**: AIの動作パターンの改善
- **信頼性の向上**: 予測可能な動作

## 参考資料

- [Claude Codeの「すぐルール忘れる問題」を解決する超効果的な方法を見つけた気がする](https://zenn.dev/sesere/articles/0420ecec9526dc)
- [Claude Code Memory Management](https://docs.anthropic.com/en/docs/claude-code/memory)
- [Claude Code Configuration Guide](https://docs.anthropic.com/en/docs/claude-code/settings)